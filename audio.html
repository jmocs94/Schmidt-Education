<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Audio Recorder - Crescendos 25-26</title>
  <style>
    body {
      font-family: 'Comic Sans MS', cursive;
      background: #f0f8ff;
      color: #333;
      text-align: center;
      padding: 2em;
    }
    h1 {
      color: #00796b;
    }
    nav {
      margin: 1em 0;
    }
    select, input, button {
      margin: 0.5em;
      font-size: 1em;
    }
    canvas {
      display: block;
      margin: 1em auto;
      width: 75%;
      max-width: 800px;
      height: 150px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background: #fff;
    }
    .controls img {
      cursor: pointer;
      width: 60px;
    }
    #song {
      width: 80%;
    }
    #song::-webkit-media-controls-play-button,
    #song::-webkit-media-controls-pause-button,
    #song::-webkit-media-controls-seek-back-button,
    #song::-webkit-media-controls-seek-forward-button,
    #song::-webkit-media-controls-timeline {
      display: none !important;
    }
  </style>
</head>
<body>
  <img src="https://raw.githubusercontent.com/jmocs94/Schmidt-Education/360c0fde872bd41d319af96a3e55bc9df7df3a54/Crescendos_w_trans.png" alt="Crescendos Logo" width="200"/>
  <h1>Crescendos 25-26 - Audio Recorder</h1>
  <p>Please use headphones! This helps avoid your microphone picking up the backing track and makes your recording clearer.</p>
  <nav><a href="index.html">⬅ Back to Recording Hub</a></nav>

  <label for="songSelect">Choose a song:</label>
  <select id="songSelect">
    <option value="https://raw.githubusercontent.com/jmocs94/Schmidt-Education/d6ffc2f4207c4d7dfc207c8d49da8863c02fe413/Crescendos%2025-26/01%20Seize%20the%20Day%20-%20Performance.mp3">Seize the Day</option>
    <option value="https://raw.githubusercontent.com/jmocs94/Schmidt-Education/cec2ad04c4b5b110795754e954b0d171db12e442/Crescendos%2025-26/3-GoTheDistance-1-Soprano.mp3">Go the Distance Soprano</option>
    <option value="https://raw.githubusercontent.com/jmocs94/Schmidt-Education/cec2ad04c4b5b110795754e954b0d171db12e442/Crescendos%2025-26/3-GoTheDistance-2-Alto.mp3">Go the Distance Alto</option>
    <option value="https://raw.githubusercontent.com/jmocs94/Schmidt-Education/cec2ad04c4b5b110795754e954b0d171db12e442/Crescendos%2025-26/3-GoTheDistance-3-Tenor.mp3">Go the Distance Tenor</option>
    <option value="https://raw.githubusercontent.com/jmocs94/Schmidt-Education/d6ffc2f4207c4d7dfc207c8d49da8863c02fe413/Crescendos%2025-26/4-LifeIsAHighway-Full.mp3">Life is a Highway</option>
    <option value="https://raw.githubusercontent.com/jmocs94/Schmidt-Education/d6ffc2f4207c4d7dfc207c8d49da8863c02fe413/Crescendos%2025-26/5-I%20Lived%20-%20SATB%20(Faster).mp3">I Lived</option>
  </select>

  <br />
  <div class="controls">
    <img id="recordButton" src="https://raw.githubusercontent.com/jmocs94/Schmidt-Education/c33a36b59f094ddec45d159cd38467f5cfaa081a/Record.png" alt="Record Button">
  </div>
  <p id="countdown" style="font-size: 2em; color: red;"></p>
  <canvas id="visualizer" width="800" height="150"></canvas>
  <p id="timer">Recording Length: 0:00</p>

  <audio id="song" controls crossorigin="anonymous"></audio>
  <audio id="playback" controls></audio>

  <br/>
  <label for="filename">File Name:</label>
  <input type="text" id="filename" />

  <button id="downloadBtn">Download</button>
  <button id="resetBtn">Reset</button>
  <p>After downloading, go to Google Classroom, open the assignment, click “Add or Create,” choose “File,” and upload your saved recording!</p>

  <script>
    let isRecording = false;
    let mediaRecorder;
    const song = document.getElementById("song");
    const recordButton = document.getElementById("recordButton");

    async function startRecording() {
      const stream = await navigator.mediaDevices.getUserMedia({
        audio: {
          echoCancellation: false,
          noiseSuppression: false,
          autoGainControl: false
        }
      });

      const chunks = [];
      mediaRecorder = new MediaRecorder(stream);

      mediaRecorder.ondataavailable = e => chunks.push(e.data);

      mediaRecorder.onstop = () => {
        const blob = new Blob(chunks, { type: 'audio/webm' });
        const url = URL.createObjectURL(blob);
        const playback = document.getElementById('playback');
        playback.src = url;
        document.getElementById("downloadBtn").onclick = () => {
          const link = document.createElement('a');
          const filename = document.getElementById('filename').value || `recording_${new Date().toISOString()}`;
          link.href = url;
          link.download = `${filename}.webm`;
          link.click();
        };
      };

      song.src = document.getElementById("songSelect").value;
      song.load();

      document.getElementById("countdown").textContent = "3";
      setTimeout(() => document.getElementById("countdown").textContent = "2", 1000);
      setTimeout(() => document.getElementById("countdown").textContent = "1", 2000);

      setTimeout(() => {
        document.getElementById("countdown").textContent = "";
        mediaRecorder.start();
        song.play();
        const timer = document.getElementById("timer");
        let seconds = 0;
        const interval = setInterval(() => {
          if (!isRecording) return clearInterval(interval);
          seconds++;
          const min = Math.floor(seconds / 60).toString().padStart(1, '0');
          const sec = (seconds % 60).toString().padStart(2, '0');
          timer.textContent = `Recording Length: ${min}:${sec}`;
        }, 1000);

        song.onended = () => {
          if (mediaRecorder.state === "recording") mediaRecorder.stop();
          isRecording = false;
        };
      }, 3000);
    }

    recordButton.addEventListener("click", () => {
      if (!isRecording) {
        isRecording = true;
        startRecording();
      } else {
        isRecording = false;
        if (mediaRecorder && mediaRecorder.state === "recording") {
          mediaRecorder.stop();
        }
        song.pause();
        song.currentTime = 0;
      }
    });
  </script>
</body>
</html>
